<!DOCTYPE html>
<html>
<head>
    <title>Custom Integration Example</title>
    <style>
        #center {
            text-align: center;
            display: flex;
            flex-direction: column;
        }
    </style>
    <script>
        geotab.addin.integrationExample = function(api, state) {
            // var center = document.getElementById("center"),
            // listCreator = function(entities) {
            //     var listElement = document.createElement("UL");
            //     listElement.appendChild(entities.reduce(function(frag, entity) {
            //         var element = document.createElement("LI");
            //         element.textContent = entity.name;
            //         element.setAttribute("data-id", entity.id);
            //         frag.appendChild(element);
            //         return frag; 
            //     }, document.createDocumentFragment()));
            //     return listElement;
            // },
            // goToVehicles = function(event) {
            //     var id = event.target.getAttribute("data-id");
            //     if (id) {
            //         state.gotoPage("device", {
            //             id: id
            //         });
            //     }
            // },
            // refreshPage = function() {
            //     api.call("Get", {
            //         typeName: "Device"
            //     }, function(result) {
            //         center.addEventListener("click", goToVehicles, false);
            //         center.appendChild(listCreator(result));
            //     }, function(error) {
            //         console.log(error.message);
            //     });
            // },
            // clearOnLeaving = function() {
            //     center.removeEventListener("click", goToVehicles, false);
            //     center.innerHTML = "";
            // };

            const addinId = 'ajg1MDg0M2UtYWZiYi05Y2Z';

            const clearOnLeaving = () => {
                document.getElementById('photoBtn').removeEventListener("click");
            };
            const takePhoto = () => {
                if (api.mobile.exists()){}
                    api.mobile.camera.takePicture().then((media) =>{
                        // do something with the base64 returned
                        console.log('media', media);
                        document.getElementById('photo').setAttribute('src', media);

                        // if (!geotab.addin.storageApiSample) {
                        //     api.call("Add",{
                        //         "typeName": "AddInData",
                        //         "entity": {
                        //             "addInId": addinId,
                        //             "details": 
                        //             {
                        //                 "photo": media
                        //             }
                        //         }
                        //     });
                        // }
                    });
            };
            const refreshPage = () => {
                document.getElementById('photoBtn').addEventListener('click', () => {
                    takePhoto();
                });
                // api.call("Add",{
                //     "typeName": "AddInData",
                //     "entity": {
                //         "addInId": addinId,
                //         "details": 
                //         {
                //             "customer": 'Artem Test'
                //         }
                //     }
                // });
                // document.getElementById('info').innerHTML = 

                api.call("Get",{
                    "typeName": "AddInData",
                    "search": {
                        "addInId": addinId,
                    }
                },
                    rezult => {
                        console.log('ok', rezult)
                        document.getElementById('info').innerHTML = rezult //[0].details.customer
                    }
                );

                // api.call("Remove", {
                //     "typeName": "AddInData",
                //     "entity": {
                //         "id": addinId
                //     }
                // });
            }

            return {
                initialize: function(api, state, callback) {
                    // refreshPage();
                    callback();
                },
                focus: function(api, state) {
                    refreshPage();
                },
                blur: function(api, state) {
                    clearOnLeaving();
                }
            }
        };
    </script>
</head>
<body>
    <!-- <input type="file" accept="image/*" capture=""> -->
    <div id="center">
        <button id="photoBtn">Take a photo</button>
        <img src="" id="photo" alt="photo">
        <pre id="info"></pre>
    </div>
</body>
</html>